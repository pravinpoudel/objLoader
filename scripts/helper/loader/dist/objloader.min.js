"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],n=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(t.push(o.value),!r||t.length!==r);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}var matLib,geometries=[];function objFileLoader(d){var r,o,t,n,w,I,a,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){for(var e=0,r=geometries;e<r.length;e++)for(var t=r[e],n=t.attributes.position,a=t.attributes.texCord,i=0,o=n.length;i<o;i+=3){var u,s,c,l,m,p,f=n.slice(i,i+3),b=n.slice(i+3,i+6),_=n.slice(i+6,i+9),y=a.slice(i,i+2),h=a.slice(i+2,i+4),g=a.slice(i+4,i+6),T=w(b,f),d=w(_,f),v=w(h,y),A=w(g,y),x=v[0]*A[1]-v[1]*A[0];x=1/x;var E=I(w(I(T,A[1]),I(d,v[1])),x),R=I(w(I(T,A[1]),I(d,v[1])),x);(u=t.tangents).push.apply(u,_toConsumableArray(E)),(s=t.tangents).push.apply(s,_toConsumableArray(E)),(c=t.tangents).push.apply(c,_toConsumableArray(E)),(l=t.biTangent).push.apply(l,_toConsumableArray(R)),(m=t.biTangent).push.apply(m,_toConsumableArray(R)),(p=t.biTangent).push.apply(p,_toConsumableArray(R))}},I=function(e,t){return e.map(function(e,r){return e*t})},w=function(e,t){return e.map(function(e,r){return e-t[r]})},n=function(){var r,t,n,a,i,c,o,l,u,s,m,p,f,b,_,y,h,g,T;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){var u={},s=a();Object.values(r).forEach(function(o){Object.entries(o).filter(function(e){if(e[0].endsWith("Map"))return!0}).map(function(e){var r=_slicedToArray(e,2),t=r[0],n=r[1];console.log(t,n);var a=u[n];if(!a){var i=new URL(n,l).href;a=c(i,s),u[n]=a}o[t]=a}),console.log(o)})},c=function(e,r){var t=new Image;return t.src=e,t.crossOrigin="",t.onload=function(){d.bindTexture(d.TEXTURE_2D,r),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,t),i(t.width)&&i(t.height)&&d.generateMipmap(d.TEXTURE_2D),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)},r},i=function(e){return 0!=e&&Math.ceil(Math.log2(e))===Math.floor(Math.log2(e))},a=function(){var e=d.createTexture();return d.bindTexture(d.TEXTURE_2D,e),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),e},r={},n={newmtl:function(e){t={},r[e[0]]=t},Ns:function(e){t.shininess=Number.apply(void 0,_toConsumableArray(e))},Ka:function(e){t.ambient=e.map(Number)},Kd:function(e){t.diffuse=e.map(Number)},Ks:function(e){t.specular=e.map(Number)},Ke:function(e){t.emissive=e.map(Number)},Ni:function(e){t.opticalDensity=Number.apply(void 0,_toConsumableArray(e))},d:function(e){t.opacity=Number.apply(void 0,_toConsumableArray(e))},illum:function(e){t.illum=Number.apply(void 0,_toConsumableArray(e))},map_Kd:function(e){t.diffuseMap=e[0]},map_Bump:function(e){t.normalMap=e[0]},map_Normal:function(e){t.normalMap=e[0]},map_Ns:function(e){console.log("specular image"),t.specularMap=e[0]}},l=new URL("/game/resources/models/objs/envy-invidia/source/3D_MNK_XII_A_839_Zawisc.obj",window.location.href),u=new URL(matLib,l).href,e.t0=regeneratorRuntime,e.next=11,regeneratorRuntime.awrap(fetch(u));case 11:return e.t1=e.sent.text(),e.next=14,e.t0.awrap.call(e.t0,e.t1);case 14:s=e.sent,m=s.split("\n"),p=/(\w*)(?: )*(.*)/,f=0,b=m.length;case 18:if(!(f<b)){e.next=36;break}if(""==(_=m[f].trim())||_.startsWith("#"))return e.abrupt("continue",33);e.next=22;break;case 22:if(y=p.exec(_)){e.next=25;break}return e.abrupt("continue",33);case 25:if(h=_slicedToArray(y,3),keyword=h[1],unparsedvalued=h[2],g=_.split(/\s+/).slice(1),T=n[keyword]){e.next=32;break}return e.abrupt("continue",33);case 32:T(g);case 33:f++,e.next=18;break;case 36:return o(),e.abrupt("return",r);case 38:case"end":return e.stop()}})},t=function(e){return e.reduce(function(e,r){var t=e.min,n=e.max,a=r.attributes.position,i=o(a);return{min:t.map(function(e,r){return Math.min(e,i.min[r])}),max:n.map(function(e,r){return Math.max(e,i.max[r])})}},{min:Array(3).fill(Number.POSITIVE_INFINITY),max:Array(3).fill(Number.NEGATIVE_INFINITY)})},o=function(e){for(var r=e.slice(0,3),t=e.slice(0,3),n=0,a=e.length;n<a;n+=3)for(var i=0;i<3;i++)r[i]=Math.min(r[i],e[n+i]),t[i]=Math.max(t[i],e[n+i]);return{min:r,max:t}},r=function(){var r,t,n,a,i,o,u,s,c,l,m,p,f,b,_,y,h,g,T,d,v,A,x,E,R,w;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return h=function(){if(!u){var e=[],r=[],t=[],n=[];s=[e,r,t,n],u={group:o,material:i,tangents:[],biTangent:[],attributes:{position:e,texCord:r,normalCord:t,colorValue:n}},geometries.push(u)}},y=function(){u=u&&void 0},_=function(e){e.split("/").forEach(function(e,r){var t,n;e&&(e=0<e?e:e+f[r].length,(t=s[r]).push.apply(t,_toConsumableArray(b(f[r][e]))),0===r&&(n=s[3]).push.apply(n,_toConsumableArray(b(p[e]))))})},b=function(e){return e.map(function(e){return Number(e)})},"/game/resources/models/objs/envy-invidia/source/3D_MNK_XII_A_839_Zawisc.obj",e.next=7,regeneratorRuntime.awrap(fetch("/game/resources/models/objs/envy-invidia/source/3D_MNK_XII_A_839_Zawisc.obj"));case 7:return r=e.sent,e.next=10,regeneratorRuntime.awrap(r.text());case 10:t=e.sent,n=t.split("\n"),a=/(\w*)(?: )*(.*)/,i="basic","default",o="",[],s=[[],[],[],[]],f=[c=[[0,0,0]],l=[[0,0]],m=[[0,0,0]],p=[[0,0,0]]],g={v:function(e){3<e.length?(c.push(b(e.slice(0,3))),p.push(b(e.slice(3)))):(c.push(b(e)),p.push([1,1,1]))},vt:function(e){l.push(b(e))},vn:function(e){m.push(b(e))},f:function(e){h();for(var r=0,t=e.length-2;r<t;r++)_(e[0]),_(e[r+1]),_(e[r+2])},mtllib:function(e){matLib=e},usemtl:function(e){y(),i=e[0]},o:function(e){e}},T=0,d=n.length;case 25:if(!(T<d)){e.next=41;break}if(""===(v=n[T].trim())||v.startsWith("#"))return e.abrupt("continue",38);e.next=29;break;case 29:if(A=a.exec(v)){e.next=32;break}return e.abrupt("continue",38);case 32:if(x=_slicedToArray(A,3),E=x[1],x[2],R=v.split(/\s+/).slice(1),w=g[E]){e.next=37;break}return e.abrupt("continue",38);case 37:w(R);case 38:T++,e.next=25;break;case 41:case"end":return e.stop()}})},e.next=9,regeneratorRuntime.awrap(r());case 9:return e.next=11,regeneratorRuntime.awrap(n());case 11:return materials=e.sent,a(),i=t(geometries),console.log(materials),e.abrupt("return",{geometries:geometries,materials:materials,minMax:i});case 16:case"end":return e.stop()}})}
//# sourceMappingURL=objloader.min.js.map
